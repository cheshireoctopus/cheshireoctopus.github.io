<!DOCTYPE html>
 <html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-ee67237fcd773d712c74.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-d7e1e4ad7664073da55c.js" as="script"/><link rel="preload" href="/path---roll-your-own-static-site-0f914bb861da0c91cb21.js" as="script"/><link rel="preload" href="/app-5838a1c42218da44cd95.js" as="script"/><link rel="preload" href="/commons-4deee803be7b7a7b08db.js" as="script"/><script id="webpack-manifest">
            //<![CDATA[
            window.webpackManifest = {"231608221292675":"app-5838a1c42218da44cd95.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","107818501498521":"component---src-templates-blog-post-js-d7e1e4ad7664073da55c.js","35783957827783":"component---src-pages-index-js-868be328f94ac3a5a63b.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","5833294425945":"path---twilio-on-rails-sms-basics-b6f79f3b633d8dcfb1d6.js","165404293618325":"path---roll-your-own-static-site-0f914bb861da0c91cb21.js","67129145200904":"path---mailchimp-gibbon-rails-d00339ad5b8e2ff470d3.js","142629428675168":"path---index-c1c81748a25e7c31e757.js","114276838955818":"component---src-layouts-index-js-ee67237fcd773d712c74.js"}
            //]]>
            </script><title data-react-helmet="true">Roll Your Own Static Site | Chandler Moisen</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75em 'Merriweather','Georgia','serif';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia','serif';font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia','serif';font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia','serif';font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia','serif';font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia','serif';font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia','serif';font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}</style><link href="//fonts.googleapis.com/css?family=Montserrat:700|Merriweather:400,400i,700,700i,900,900i" rel="stylesheet" type="text/css"/><script>
  !function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",[
  "/commons-4deee803be7b7a7b08db.js","/app-5838a1c42218da44cd95.js","/path---roll-your-own-static-site-0f914bb861da0c91cb21.js","/component---src-templates-blog-post-js-d7e1e4ad7664073da55c.js","/component---src-layouts-index-js-ee67237fcd773d712c74.js"
])
  </script><style id="gatsby-inlined-css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style></head><body><div id="___gatsby"><div style="max-width:42rem;margin-left:auto;margin-right:auto;padding:2.625rem 1.3125rem;" data-reactroot="" data-reactid="1" data-react-checksum="1736658977"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:-1.75rem;" data-reactid="2"><a style="box-shadow:none;text-decoration:none;color:inherit;" href="/" data-reactid="3">Chandler Moisen</a></h3><div data-reactid="4"><!-- react-empty: 5 --><h1 data-reactid="6">Roll Your Own Static Site</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem;" data-reactid="7">June 12, 2017</p><div data-reactid="8"><p><img src="/054ca163e31520d2625820020aa4870a.gif" alt="rolling on friday"></p>
<p>Recently I decided to rebuild my long neglected and dilapidated blog - previously powered by <a href="http://octopress.org/">Octopress</a> - using JavaScript.</p>
<p>As a blog is a perfect use case for a static site generator, I first investigated exisiting solutions, and found, as expected, there are already quite a few available:</p>
<ul>
<li><a href="http://www.metalsmith.io/">Metalsmith</a></li>
<li><a href="https://hexo.io/">Hexo</a></li>
<li><a href="http://wintersmith.io/">Wintersmith</a></li>
</ul>
<p>See <a href="https://www.staticgen.com/">https://www.staticgen.com/</a> for even more.</p>
<p>While more than sufficient, I found these to be overkill as all I really needed was to <strong>convert some markdown into HTML</strong>.</p>
<p>Add a pinch of CSS, maybe your favorite frontend view layer, and that’s it - you’re cruising.</p>
<p>So, as any self-respecting dev would do, I rolled my own with React - check it out <a href="https://github.com/cheshireoctopus/cheshireoctopus.github.io">here</a>.</p>
<h2>Structure</h2>
<p>The structure (simplified below) is pretty straight-forward:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>|-- app
|	|-- components
|	|-- index.js
|	|-- posts.json
|	|-- projects.json
|-- bin
|	|-- gen
|-- public
|	|-- blog
|		|-- my_first_post
|			|-- img
|			|-- data.json
|			|-- post.md
|-- index.html
|-- webpack.confg.js</code></pre>
      </div>
<p><code>app/components/</code> holds all the <code>.jsx</code>, and uses <code>posts.json</code> - created via <code>bin/gen</code> (see below) - to populate the blog posts.</p>
<p>Blog posts are stored as individual directories in <code>public/blog/</code>; each post directory contains:</p>
<ul>
<li><code>data.json</code></li>
<li><code>post.md</code></li>
<li><code>img/</code></li>
</ul>
<p><code>data.json</code> contains post-specific metadata (<code>title</code>, <code>date</code>, <code>topics</code>), while <code>post.md</code> contains the related markdown content; <code>img/</code> holds the post’s images.</p>
<p>See an example <a href="https://github.com/cheshireoctopus/cheshireoctopus.github.io/tree/master/public/blog/twilio_on_rails_sms_basics">here</a>.</p>
<p>Running <code>./bin/gen</code> from root parses through each post directory in <code>public/blog/</code>, transforms the <code>post.md</code> file into HTML, and then adds this string under the key <code>html</code> to the relative <code>data.json</code> object. Each JSON object is then pushed to an array and outputted at <code>app/posts.json</code> for use inside the React app.</p>
<h2>Markdown to HTML</h2>
<p>The core of the blog is powered by a single shell script that rips through a bunch of markdown files, converting them into HTML:</p>
<div class="gatsby-highlight">
      <pre class="language-javascript"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'bluebird'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">promisifyAll</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> marked <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'marked'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> highlightjs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'highlight.js'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> PATH_TO_ROOT <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> PATH_TO_APP <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>PATH_TO_ROOT<span class="token punctuation">,</span> <span class="token string">'app'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> PATH_TO_SRC <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>PATH_TO_ROOT<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">,</span> <span class="token string">'blog'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">marked<span class="token punctuation">.</span>Renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
renderer<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token punctuation">(</span>code<span class="token punctuation">,</span> language<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> validLang <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>language <span class="token operator">&amp;&amp;</span> highlightjs<span class="token punctuation">.</span><span class="token function">getLanguage</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> highlighted <span class="token operator">=</span> validLang <span class="token operator">?</span> highlightjs<span class="token punctuation">.</span><span class="token function">highlight</span><span class="token punctuation">(</span>language<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">:</span> code
	<span class="token keyword">return</span> <span class="token template-string"><span class="token string">`&lt;pre>&lt;code class="hljs </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>language<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>highlighted<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code>&lt;/pre>`</span></span>
<span class="token punctuation">}</span>
renderer<span class="token punctuation">.</span>image <span class="token operator">=</span> <span class="token punctuation">(</span>src<span class="token punctuation">,</span> title<span class="token punctuation">,</span> alt<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token template-string"><span class="token string">`&lt;div class="post-image-container">&lt;img src="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" alt="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>alt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"/>&lt;/div>`</span></span>
<span class="token punctuation">}</span>

marked<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	renderer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readdirAsync</span><span class="token punctuation">(</span>PATH_TO_SRC<span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>posts <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>posts<span class="token punctuation">,</span> postDir <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> srcPostDir <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>PATH_TO_SRC<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>postDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>

			<span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readdirAsync</span><span class="token punctuation">(</span>srcPostDir<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>files <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
					<span class="token keyword">const</span> readJSON <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileAsync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>srcPostDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/data.json`</span></span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
					<span class="token keyword">const</span> readMD <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileAsync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>srcPostDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/post.md`</span></span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>

					<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>readJSON<span class="token punctuation">,</span> readMD<span class="token punctuation">,</span> <span class="token punctuation">(</span>json<span class="token punctuation">,</span> md<span class="token punctuation">,</span> imgs<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
						<span class="token keyword">const</span> data <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>

						<span class="token keyword">return</span> <span class="token punctuation">{</span>
							date<span class="token punctuation">:</span> data<span class="token punctuation">.</span>date<span class="token punctuation">,</span>
							topics<span class="token punctuation">:</span> data<span class="token punctuation">.</span>topics<span class="token punctuation">,</span>
							title<span class="token punctuation">:</span> data<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
							urlTitle<span class="token punctuation">:</span> postDir<span class="token punctuation">,</span>
							html<span class="token punctuation">:</span> <span class="token function">marked</span><span class="token punctuation">(</span>md<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>postCollection<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
		postCollection <span class="token operator">=</span> postCollection<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>date<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>

		fs<span class="token punctuation">.</span><span class="token function">writeFileAsync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>PATH_TO_APP<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/posts.json`</span></span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>postCollection<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Congratulations - generated </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>postCollection<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> posts.`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
      </div>
<h2>Bluebird’s <code>.promisifyAll</code></h2>
<p>A quick note: asynchronous file input/output can quickly lead to a labyrinth of callbacks. To help mitigate sphagetti code, you’ll see that I leveraged <code>Bluebird.promisifyAll</code> (<a href="http://bluebirdjs.com/docs/api/promise.promisifyall.html">documentation</a>) by wrapping Node’s <code>fs</code> module:</p>
<div class="gatsby-highlight">
      <pre class="language-javascript"><code><span class="token keyword">const</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'bluebird'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">promisifyAll</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
      </div>
<p><code>.promisifyAll</code> parses through an object, “promisifying” the object’s methods. These new promises are accessed via the original method’s name + a suffix of <code>Async</code>.</p>
<p>For example, to read a directory using <code>fs</code>, one would typically call <code>fs.readdir</code>; when wrapped using <code>promisifyAll</code> one would call <code>fs.readdirAsync</code>.</p>
<h2>Marked: Custom Parsers</h2>
<p>To convert markdown into HTML, I relied upon <a href="https://github.com/chjj/marked">marked</a> and <a href="https://highlightjs.org/">highlight.js</a>.</p>
<p>While marked will convert markdown to HTML out of the box, it does require custom configuration when rendering code blocks and applying syntax highlighting. Thankfully, this process is pretty easy, thanks to hightlight.js.</p>
<p>The majority of marked’s configuration can be accessed via its <a href="https://github.com/chjj/marked#renderer">marked.Renderer()</a> API. This allows the developer to define functions which are invoked when parsing certain <a href="https://github.com/chjj/marked#block-level-renderer-methods">block</a> or <a href="https://github.com/chjj/marked#inline-level-renderer-methods">inline</a> elements.</p>
<p>For example, to apply custom markup to an image element, first instantiate a new <code>Renderer()</code> object, define an <code>image</code> method on this object describing what HTML should returned when parsing an image, and finally use <code>.setOptions</code> to apply the custom rendering.</p>
<div class="gatsby-highlight">
      <pre class="language-javascript"><code><span class="token keyword">import</span> marked <span class="token keyword">from</span> <span class="token string">'marked'</span>

<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">marked<span class="token punctuation">.</span>Renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

renderer<span class="token punctuation">.</span>image <span class="token operator">=</span> <span class="token punctuation">(</span>src<span class="token punctuation">,</span> title<span class="token punctuation">,</span> alt<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token template-string"><span class="token string">`&lt;div class="post-image-container">&lt;img src="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" alt="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>alt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"/>&lt;/div>`</span></span>
<span class="token punctuation">}</span>

marked<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	renderer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
      </div>
<p>Applying custom rendering to a code block would be similar, except you would utilize hightlight.js to apply syntax highlighting. Check out this <a href="http://shuheikagawa.com/blog/2015/09/21/using-highlight-js-with-marked/">post</a> for some more detail.</p>
<div class="gatsby-highlight">
      <pre class="language-javascript"><code><span class="token keyword">import</span> marked <span class="token keyword">from</span> <span class="token string">'marked'</span>
<span class="token keyword">import</span> highlightjs <span class="token keyword">from</span> <span class="token string">'highlight.js'</span>

<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">marked<span class="token punctuation">.</span>Renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

renderer<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token punctuation">(</span>code<span class="token punctuation">,</span> language<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> validLang <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>language <span class="token operator">&amp;&amp;</span> highlightjs<span class="token punctuation">.</span><span class="token function">getLanguage</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> highlighted <span class="token operator">=</span> validLang <span class="token operator">?</span> highlightjs<span class="token punctuation">.</span><span class="token function">highlight</span><span class="token punctuation">(</span>language<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">:</span> code
	<span class="token keyword">return</span> <span class="token template-string"><span class="token string">`&lt;pre>&lt;code class="hljs </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>language<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>highlighted<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code>&lt;/pre>`</span></span>
<span class="token punctuation">}</span>

marked<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	renderer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
      </div>
<p>One caveat when hightlight.js - it does not ship with line numbers in code blocks. According to the library’s author(s), this is <a href="http://highlightjs.readthedocs.io/en/latest/line-numbers.html">“not an oversight but a feature”</a>, and it does appear that a <a href="https://github.com/wcoder/highlightjs-line-numbers.js/">plugin</a> was built to add them in.</p></div><hr style="margin-bottom:1.75rem;" data-reactid="9"/></div><span style="display:block;clear:both;" data-reactid="10"> </span></div></div><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'undefined', 'auto');
  ga('send', 'pageview');
      </script></body></html>